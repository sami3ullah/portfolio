---
import StarsText from '../StarsText.astro';
import StoryView from './StoryView.astro';
---

<!-- 1st paragraph -->
<section
  id="main__story"
  class="relative w-full min-h-auto md:min-h-[120vh] bg-darkBackground md:bg-black min-w-full"
>
  <!-- hidden on mobile, visible on other devices -->
  <div class="ml-8 absolute bottom-1/2 left-0 -translate-x-1/2 rotate-90">
    <a href="#portfolio-projects" class="text-textDullest underline">Skip Story</a
    >
  </div>
  <!-- visible on mobile, hidden on other devices -->
  <div class="w-[5rem] h-[5rem] mobile_skip_story z-30 hidden md:hidden rounded-full font-[600] leading-normal bg-textLightPrimary fixed bottom-4 right-4 items-center justify-center">
    <a href="#portfolio-projects" class="text-darkBackground2  uppercase text-center">Skip <br> Story</a
    >
  </div>
  <div class="px-pageXMobile lg:px-pageX">
    <div
      class="hidden md:block story-heading text-textLightPrimary absolute top-[30%] translate-y-[-30%] md:text-[3rem] lg:text-[5rem] font-[500] uppercase"
    >
      The <StarsText showStars={true}>Story</StarsText> I Told My <StarsText
        showStars={true}
      >
        Wife
      </StarsText>
    </div>
    <StoryView id="card-one">
      <h2
        class="text-[#b9bcad] story_text w-full lg:w-[80%] font-[500] text-[1.5rem] leading-[40px] md:text-[3rem] lg:text-[4rem] text-left md:leading-[85px]"
      >
        I was born in a small, tech deprived town, with a dream of becoming a
        <span><StarsText>Software Engineer</StarsText></span> one day ü•π
      </h2>
    </StoryView>
    <StoryView id="card-two">
      <h2
        class="text-[#b9bcad] story_text w-full lg:w-[80%] font-[300] text-[1.5rem] leading-[40px] md:text-[3rem] lg:text-[4rem] text-left lg:text-left md:leading-[85px]"
      >
        After school, I wanted to move to a big city for college to fulfill <StarsText
        >
          my dream
        </StarsText>, but my parents thought I was too young to move out üôÅ
      </h2>
    </StoryView>
    <StoryView id="card-three">
      <h2
        class="text-[#b9bcad] story_text w-full lg:w-[80%] font-[00] md:font-[400] text-[1.5rem] leading-[40px] md:text-[3rem] lg:text-[4rem] text-left lg:text-left md:leading-[85px]"
      >
        Despite that, I still managed to moved out to pursue my dream, Reaching there I felt lost among tech
        savvy folks. I didn't even know what a <StarsText>
          PlayStation
        </StarsText>
         was ü§Ø
      </h2>
    </StoryView>
    <StoryView id="card-four">
      <h2
        class="text-[#b9bcad] story_text w-full lg:w-[80%] font-[600] md:font-[300] text-[1.5rem] leading-[40px] md:text-[3rem] text-left lg:text-left md:leading-[85px]"
      >
        College was a whirlwind, and I felt <StarsText>
          lost and overwhelmed
        </StarsText> most of the time. But I refused to give up. As I taught
        myself coding, everything slowly started to fall into place ü•∞
      </h2>
    </StoryView>
    <StoryView id="card-five">
      <h2
        class="text-[#b9bcad] story_text w-full lg:w-[80%] font-[300] md:font-[300] text-[1.5rem] leading-[40px] md:text-[3rem] lg:text-[3.5rem] text-left lg:text-left md:leading-[85px]"
      >
        <StarsText>I faced countless failures</StarsText> along the way. But, I
        never let them define me. My perseverance and hard work have brought me
        this far, eager to see what the future holds üòå
      </h2>
    </StoryView>
  </div>
</section>

<script>
  import gsap from 'gsap';
  import SplitType from 'split-type';
  import { ScrollTrigger } from 'gsap/ScrollTrigger';
  gsap.registerPlugin(ScrollTrigger);
  import { isMobileViewport } from '../../utils';

  const isMobileView = isMobileViewport();
  // don't animate if it's a mobile device
  if (!isMobileView) {
    var tl = gsap.timeline({
      ease: 'ease-in-out',
      scrollTrigger: {
        trigger: '#main__story',
        start: 'top top',
        end: '100% 50%',
        scrub: 2,
        pin: true,
      },
    });

    tl.to(
      '#card-one',
      {
        background: '#101010',
        borderRadius: '1.25rem',
        top: '35%',
      },
      'first'
    )
      .to('.story-heading', {
        x: '10%',
        opacity: 0,
      })
      .to(
        '#card-two',
        {
          top: '130%',
          background: '#101010',
          borderRadius: '1.25rem',
        },
        'first'
      )
      .to(
        '#card-two',
        {
          top: '42%',
        },
        'second'
      )
      .to(
        '#card-one',
        {
          width: '70%',
          height: '75vh',
        },
        'second'
      )
      .to(
        '#card-three',
        {
          top: '130%',
          background: '#101010',
          borderRadius: '1.25rem',
        },
        'second'
      )
      .to(
        '#card-three',
        {
          top: '49%',
        },
        'third'
      )
      .to(
        '#card-two',
        {
          width: '75%',
          height: '75vh',
        },
        'third'
      )
      .to(
        '#card-four',
        {
          top: '130%',
          background: '#101010',
          borderRadius: '1.25rem',
        },
        'third'
      )
      .to(
        '#card-four',
        {
          top: '56%',
        },
        'fourth'
      )
      .to(
        '#card-three',
        {
          width: '80%',
          height: '75vh',
        },
        'fourth'
      )
      .to(
        '#card-five',
        {
          top: '130%',
          background: '#101010',
          borderRadius: '1.25rem',
        },
        'fourth'
      )
      .to(
        '#card-five',
        {
          top: '63%',
          width: '90%',
          height: '75vh',
        },
        'fifth'
      )
      .to(
        '#card-four',
        {
          width: '85%',
          height: '75vh',
        },
        'fifth'
      );
  }

  // if the device is mobile
  if(isMobileView){
    const storySections = document.querySelectorAll(".story_view");

    storySections.forEach((text, index) => {
      const splitText = new SplitType(text, { types: 'words'})
      gsap.fromTo(
        splitText.words,
        {
          opacity: 0.2,
        },
        {
          opacity: 1,
          duration: 0.5,
          stagger: 0.2,
          scrollTrigger: {
            trigger: storySections[index],
            start: "top 80%",
            end: "top 40%",
            scrub: true,
            toggleActions: 'play play reverse reverse'
          },
        }
      );
    });

    gsap.to(".mobile_skip_story",{
      ease: 'power1.inOut',
      scrollTrigger: {
        trigger: "#main__story",
        start: "top 80%",
        end: "90% 80%",
        scrub: true,
        toggleActions: 'play play reverse reverse',
        onLeave: () => {
          gsap.to(".mobile_skip_story",{
            display: "none",
            duration: 0.2,
          })
        },
        onEnterBack: () => {
          gsap.to(".mobile_skip_story",{
            display: "flex",
            duration: 0.2,
          })
        },
        onEnter: () => {
          gsap.to(".mobile_skip_story",{
            display: "flex",
            duration: 0.2,
          })
        },
        onLeaveBack: () => {
          gsap.to(".mobile_skip_story",{
            display: "none",
            duration: 0.2,
          })
        },
      },
    })
  }
</script>
